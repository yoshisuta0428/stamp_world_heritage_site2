<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>世界遺産スタンプラリー（日本）</title>

<style>
/* ===== 全体 ===== */
body {
  margin: 0;
  font-family: "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
  background: linear-gradient(180deg, #f9fafb, #eef2f7);
}

.screen {
  display: none;
  padding: 16px;
}
.screen.active {
  display: block;
}

h1 {
  text-align: center;
  font-size: 20px;
  margin-bottom: 12px;
}

/* ===== 広告 ===== */
.ad {
  background: #e5e7eb;
  border-radius: 12px;
  text-align: center;
  padding: 14px;
  margin: 14px 0;
  font-size: 14px;
  color: #555;
}

.video-ad {
  height: 180px;
  background: #000;
  color: #fff;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 16px 0;
}

/* ===== 入力 ===== */
input[type="text"] {
  width: 100%;
  padding: 12px;
  font-size: 15px;
  border-radius: 12px;
  border: 1px solid #ccc;
  margin-bottom: 12px;
}

/* ===== チェックリスト ===== */
.list {
  background: #fff;
  border-radius: 16px;
  padding: 12px 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,.08);
}

.list label {
  display: flex;
  gap: 10px;
  padding: 10px 0;
  font-size: 15px;
  line-height: 1.4;
  border-bottom: 1px solid #eee;
}

.list label:last-child {
  border-bottom: none;
}

.list input {
  margin-top: 4px;
  transform: scale(1.2);
}

/* ===== ボタン ===== */
button {
  width: 100%;
  padding: 14px;
  margin-top: 12px;
  font-size: 16px;
  border-radius: 14px;
  border: none;
  background: linear-gradient(135deg, #2563eb, #1e40af);
  color: #fff;
  font-weight: bold;
  box-shadow: 0 6px 16px rgba(0,0,0,.15);
  cursor: pointer;
}

button.secondary {
  background: #111827;
}

button.gray {
  background: #6b7280;
}

/* ===== ローディング ===== */
.loader {
  width: 48px;
  height: 48px;
  border: 4px solid #ccc;
  border-top-color: #2563eb;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 24px auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ===== 完成 ===== */
canvas {
  display: block;
  margin: 16px auto;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,.12);
}
</style>
</head>

<body>

<!-- ① チェック画面 -->
<div id="screen-check" class="screen active">
  <h1>世界遺産スタンプラリー（日本）</h1>

  <input id="username" type="text" placeholder="あなたの名前（例：太郎）">

  <div class="ad">広告枠（上）</div>

  <div class="list">
    <label><input type="checkbox" value="知床">知床</label>
    <label><input type="checkbox" value="北海道・北東北の縄文遺跡群">北海道・北東北の縄文遺跡群</label>
    <label><input type="checkbox" value="白神山地">白神山地</label>
    <label><input type="checkbox" value="平泉－仏国土（浄土）を表す建築・庭園及び考古学的遺跡群">平泉－仏国土（浄土）を表す建築・庭園及び考古学的遺跡群</label>
    <label><input type="checkbox" value="日光の社寺">日光の社寺</label>
    <label><input type="checkbox" value="富岡製糸場と絹産業遺産群">富岡製糸場と絹産業遺産群</label>
    <label><input type="checkbox" value="ル・コルビュジエの建築作品－近代建築運動への顕著な貢献">ル・コルビュジエの建築作品－近代建築運動への顕著な貢献</label>
    <label><input type="checkbox" value="小笠原諸島">小笠原諸島</label>
    <label><input type="checkbox" value="富士山－信仰の対象と芸術の源泉">富士山－信仰の対象と芸術の源泉</label>
    <label><input type="checkbox" value="佐渡島の金山">佐渡島の金山</label>
    <label><input type="checkbox" value="白川郷・五箇山の合掌造り集落">白川郷・五箇山の合掌造り集落</label>
    <label><input type="checkbox" value="古都京都の文化財">古都京都の文化財</label>
    <label><input type="checkbox" value="姫路城">姫路城</label>
    <label><input type="checkbox" value="古都奈良の文化財">古都奈良の文化財</label>
    <label><input type="checkbox" value="法隆寺地域の仏教建造物">法隆寺地域の仏教建造物</label>
    <label><input type="checkbox" value="紀伊山地の霊場と参詣道">紀伊山地の霊場と参詣道</label>
    <label><input type="checkbox" value="百舌鳥・古市古墳群－古代日本の墳墓群">百舌鳥・古市古墳群－古代日本の墳墓群</label>
    <label><input type="checkbox" value="原爆ドーム">原爆ドーム</label>
    <label><input type="checkbox" value="石見銀山遺跡とその文化的景観">石見銀山遺跡とその文化的景観</label>
    <label><input type="checkbox" value="厳島神社">厳島神社</label>
    <label><input type="checkbox" value="明治日本の産業革命遺産 製鉄・製鋼、造船、石炭産業">明治日本の産業革命遺産 製鉄・製鋼、造船、石炭産業</label>
    <label><input type="checkbox" value="「神宿る島」宗像・沖ノ島と関連遺産群">「神宿る島」宗像・沖ノ島と関連遺産群</label>
    <label><input type="checkbox" value="長崎と天草地方の潜伏キリシタン関連遺産">長崎と天草地方の潜伏キリシタン関連遺産</label>
    <label><input type="checkbox" value="屋久島">屋久島</label>
    <label><input type="checkbox" value="琉球王国のグスク及び関連遺産群">琉球王国のグスク及び関連遺産群</label>
    <label><input type="checkbox" value="奄美大島、徳之島、沖縄島北部及び西表島">奄美大島、徳之島、沖縄島北部及び西表島</label>
  </div>

  <button id="to-loading">画像を生成</button>

  <div class="ad">広告枠（下）</div>
</div>

<!-- ② 生成中 -->
<div id="screen-loading" class="screen">
  <h1>生成中です…</h1>
  <div class="loader"></div>
  <div class="video-ad" id="videoAd">動画広告再生中（5秒）</div>
  <button id="to-result" style="display:none;">画像を見る</button>
</div>

<!-- ③ 完成 -->
<div id="screen-result" class="screen">
  <h1>完成しました</h1>
  <p id="progress" style="text-align:center;font-weight:bold;"></p>
  <canvas id="canvas"></canvas>

  <button id="saveImage" class="gray">画像を保存</button>
  <button id="shareX">Xでシェア</button>
  <button id="shareLine" class="secondary">LINEでシェア</button>
</div>

<script>
const screens = {
  check: screenCheck = document.getElementById("screen-check"),
  loading: document.getElementById("screen-loading"),
  result: document.getElementById("screen-result")
};

function showScreen(name) {
  Object.values(screens).forEach(s => s.classList.remove("active"));
  screens[name].classList.add("active");
}

/* 位置データ（調整済み想定） */
const positions = {
  "知床": { x: 1220, y: 60 },
  "北海道・北東北の縄文遺跡群": { x: 1120, y: 380 },
  "白神山地": { x: 880, y: 370 },
  "平泉－仏国土（浄土）を表す建築・庭園及び考古学的遺跡群": { x: 1160, y: 540 },
  "日光の社寺": { x: 1100, y: 700 },
  "富岡製糸場と絹産業遺産群": { x: 1080, y: 850 },
  "ル・コルビュジエの建築作品－近代建築運動への顕著な貢献": { x: 1190, y: 990 },
  "小笠原諸島": { x: 1280, y: 1140 },
  "富士山－信仰の対象と芸術の源泉": { x: 940, y: 980 },
  "佐渡島の金山": { x: 860, y: 520 },
  "白川郷・五箇山の合掌造り集落": { x: 740, y: 600 },
  "古都京都の文化財": { x: 660, y: 460 },
  "姫路城": { x: 560, y: 730 },
  "古都奈良の文化財": { x: 800, y: 1000 },
  "法隆寺地域の仏教建造物": { x: 660, y: 1070 },
  "紀伊山地の霊場と参詣道": { x: 535, y: 1160 },
  "百舌鳥・古市古墳群－古代日本の墳墓群": { x: 400, y: 1170 },
  "原爆ドーム": { x: 420, y: 690 },
  "石見銀山遺跡とその文化的景観": { x: 270, y: 700 },
  "厳島神社": { x: 260, y: 840 },
  "明治日本の産業革命遺産 製鉄・製鋼、造船、石炭産業": { x: 90, y: 710 },
  "「神宿る島」宗像・沖ノ島と関連遺産群": { x: 115, y: 900 },
  "長崎と天草地方の潜伏キリシタン関連遺産": { x: 80, y: 1040 },
  "屋久島": { x: 170, y: 1170 },
  "琉球王国のグスク及び関連遺産群": { x: 930, y: 1170 },
  "奄美大島、徳之島、沖縄島北部及び西表島": { x: 1075, y: 1090 }
};

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const mapImg = new Image();
const stampImg = new Image();
mapImg.src = "japan_map.png";
stampImg.src = "checkmark.png";

let selected = [];
let userName = "";

document.getElementById("to-loading").onclick = () => {
  selected = [...document.querySelectorAll("input:checked")].map(c => c.value);
  userName = document.getElementById("username").value || "名無し";
  showScreen("loading");

  setTimeout(() => {
    document.getElementById("videoAd").textContent = "動画広告終了";
    document.getElementById("to-result").style.display = "block";
  }, 5000);
};

document.getElementById("to-result").onclick = () => {
  showScreen("result");
  document.getElementById("progress").textContent =
    `達成率 ${selected.length} / 26`;

  const draw = () => {
    const scale = Math.min(window.innerWidth / mapImg.width, 1);
    canvas.width = mapImg.width;
    canvas.height = mapImg.height;
    canvas.style.width = mapImg.width * scale + "px";

    ctx.drawImage(mapImg, 0, 0);

    const stampSize = 360;
    selected.forEach(name => {
      const p = positions[name];
      if (!p) return;
      ctx.drawImage(
        stampImg,
        p.x - stampSize / 2,
        p.y - stampSize / 2,
        stampSize,
        stampSize
      );
    });

    ctx.font = "bold 48px sans-serif";
    ctx.fillStyle = "#111";
    ctx.textAlign = "right";
    ctx.fillText(`制覇者：${userName}`, canvas.width - 40, canvas.height - 40);
  };

  if (mapImg.complete) draw();
  else mapImg.onload = draw;
};

/* 保存 */
document.getElementById("saveImage").onclick = () => {
  const a = document.createElement("a");
  a.download = "world-heritage-japan.png";
  a.href = canvas.toDataURL("image/png");
  a.click();
};

/* シェア */
function shareText() {
  return encodeURIComponent(
    `日本の世界遺産スタンプラリーを${selected.length}件制覇！\n#世界遺産 #スタンプラリー`
  );
}

document.getElementById("shareX").onclick = () => {
  window.open(`https://twitter.com/intent/tweet?text=${shareText()}`, "_blank");
};

document.getElementById("shareLine").onclick = () => {
  window.open(`https://social-plugins.line.me/lineit/share?text=${shareText()}`, "_blank");
};
</script>

</body>
</html>
