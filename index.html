<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>世界遺産スタンプラリー（日本）</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #f4f6f8;
  overflow-x: hidden;
}

.screen { display: none; padding: 16px; }
.screen.active { display: block; }

h1 { text-align: center; font-size: 22px; }

.list label {
  display: block;
  padding: 8px 0;
  font-size: 14px;
}

input[type="text"] {
  width: 100%;
  max-width: 420px;
  padding: 10px;
  margin-bottom: 12px;
  box-sizing: border-box;
}

button {
  width: 100%;
  max-width: 420px;
  padding: 14px;
  margin: 12px auto 0;
  display: block;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: #2563eb;
  color: #fff;
}

canvas {
  display: block;
  margin: 0 auto;
  background: #fff;
  border-radius: 12px;
  width: 100%;
  max-width: 420px;
}

.share {
  display: flex;
  gap: 12px;
  margin-top: 16px;
  max-width: 420px;
  margin-left: auto;
  margin-right: auto;
}

.share a {
  flex: 1;
  text-align: center;
  padding: 12px;
  border-radius: 8px;
  color: #fff;
  text-decoration: none;
}

.x { background: #000; }
.line { background: #06c755; }
</style>
</head>

<body>

<div id="screen-check" class="screen active">
<h1>世界遺産スタンプラリー（日本）</h1>
<input id="userName" type="text" placeholder="作成者名を入力">

<div class="list">
<label><input type="checkbox" value="知床"> 知床</label>
<label><input type="checkbox" value="北海道・北東北の縄文遺跡群"> 北海道・北東北の縄文遺跡群</label>
<label><input type="checkbox" value="白神山地"> 白神山地</label>
<label><input type="checkbox" value="平泉－仏国土（浄土）を表す建築・庭園及び考古学的遺跡群"> 平泉－仏国土（浄土）を表す建築・庭園及び考古学的遺跡群</label>
<label><input type="checkbox" value="日光の社寺"> 日光の社寺</label>
<label><input type="checkbox" value="富岡製糸場と絹産業遺産群"> 富岡製糸場と絹産業遺産群</label>
</div>

<button id="toResult">画像を生成</button>
</div>

<div id="screen-result" class="screen">
<h1>完成しました</h1>
<canvas id="viewCanvas"></canvas>
<button id="saveImage">画像を保存</button>

<div class="share">
<a id="shareX" class="x" target="_blank">Xでシェア</a>
<a id="shareLine" class="line" target="_blank">LINEでシェア</a>
</div>
</div>

<script>
const screens={
  check:screenCheck=document.getElementById("screen-check"),
  result:screenResult=document.getElementById("screen-result")
};

function showScreen(n){
  Object.values(screens).forEach(s=>s.classList.remove("active"));
  screens[n].classList.add("active");
}

const positions={
  "知床":{x:1220,y:60},
  "北海道・北東北の縄文遺跡群":{x:1120,y:380},
  "白神山地":{x:880,y:370},
  "平泉－仏国土（浄土）を表す建築・庭園及び考古学的遺跡群":{x:1160,y:540},
  "日光の社寺":{x:1100,y:700},
  "富岡製糸場と絹産業遺産群":{x:1080,y:850}
};

const mapImg=new Image();
const stampImg=new Image();
mapImg.src="japan_map.png";
stampImg.src="checkmark.png";

const viewCanvas=document.getElementById("viewCanvas");
const viewCtx=viewCanvas.getContext("2d");

const saveCanvas=document.createElement("canvas");
const saveCtx=saveCanvas.getContext("2d");

let selected=[];

document.getElementById("toResult").onclick=()=>{
  selected=[...document.querySelectorAll("input:checked")].map(c=>c.value);
  showScreen("result");

  // 表示用
  const scale=Math.min(420/mapImg.width,1);
  viewCanvas.width=mapImg.width*scale;
  viewCanvas.height=mapImg.height*scale;
  viewCtx.drawImage(mapImg,0,0,viewCanvas.width,viewCanvas.height);

  // 保存用（元サイズ）
  saveCanvas.width=mapImg.width;
  saveCanvas.height=mapImg.height;
  saveCtx.drawImage(mapImg,0,0);

  selected.forEach(n=>{
    const p=positions[n];
    if(!p)return;
    viewCtx.drawImage(stampImg,(p.x-100)*scale,(p.y-100)*scale,200*scale,200*scale);
    saveCtx.drawImage(stampImg,p.x-100,p.y-100,200,200);
  });

  saveCtx.font="36px sans-serif";
  saveCtx.fillText("作成者："+(userName.value||"No Name"),20,160);

  const url=encodeURIComponent(location.href);
  shareX.href=`https://twitter.com/intent/tweet?url=${url}`;
  shareLine.href=`https://social-plugins.line.me/lineit/share?url=${url}`;
};

document.getElementById("saveImage").onclick=()=>{
  saveCanvas.toBlob(blob=>{
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="world-heritage.png";
    a.click();
    URL.revokeObjectURL(a.href);
  });
};
</script>

</body>
</html>
